---
import { NUMBER_OF_POSTS_PER_PAGE } from '../server-constants.ts'
import {
  getPosts,
  getRankedPosts,
  getAllTags,
  getNumberOfPages,
  getFeaturedPost,
  getTopPosts,
} from '../lib/notion/client.ts'
import Layout from '../layouts/Layout.astro'
import NoContents from '../components/NoContents.astro'
import PostDate from '../components/PostDate.astro'
import PostTags from '../components/PostTags.astro'
import PostTitle from '../components/PostTitle.astro'
import PostFeaturedImage from '../components/PostFeaturedImage.astro'
import PostExcerpt from '../components/PostExcerpt.astro'
import ReadMoreLink from '../components/ReadMoreLink.astro'
import Pagination from '../components/Pagination.astro'
import BlogPostsLink from '../components/BlogPostsLink.astro'
import BlogTagsLink from '../components/BlogTagsLink.astro'
import { getPostLink } from '../lib/blog-helpers.ts'
import { filePath } from '../lib/blog-helpers.ts'

const labels = {
  categories: 'Kategorias',
}
const [posts, rankedPosts, tags, numberOfPages, featuredPost, topPosts] = await Promise.all([
  getPosts(NUMBER_OF_POSTS_PER_PAGE),
  getRankedPosts(),
  getAllTags(),
  getNumberOfPages(),
  getFeaturedPost(),
  getTopPosts(4),
])
---

<Layout title="Ligadu" description="Artigus di siensia i saudi" path="/" ogImage="">
  <!-- Featured Section - Above main and aside -->
  {
    (featuredPost || topPosts.length > 0) && (
      <section slot="featured" class="mb-12 px-5 py-8 max-sm:px-2.5 max-sm:py-5" style="max-width: 1200px; margin: 0 auto;">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Main Featured Article -->
          {
            featuredPost && (
              <div class="lg:col-span-2">
                <a href={getPostLink(featuredPost.Slug)} class="block group">
                  <div class="relative overflow-hidden rounded-lg mb-4 aspect-[16/10] bg-slate-200">
                    {
                      featuredPost.FeaturedImage && featuredPost.FeaturedImage.Url ? (
                        <img 
                          src={import.meta.env.DEV ? featuredPost.FeaturedImage.Url : filePath(new URL(featuredPost.FeaturedImage.Url))} 
                          alt={featuredPost.Title}
                          class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                        />
                      ) : (
                        <div class="w-full h-full flex items-center justify-center bg-slate-300">
                          <svg class="w-16 h-16 text-slate-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                          </svg>
                        </div>
                      )
                    }
                  </div>
                  <div class="space-y-3">
                    <div class="flex items-center gap-2 text-xs text-slate-500 uppercase tracking-wide">
                      <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded font-semibold">Featured</span>
                      <PostDate post={featuredPost} />
                    </div>
                    <h2 class="text-3xl font-bold text-slate-900 group-hover:text-blue-600 transition-colors leading-tight">
                      {featuredPost.Title}
                    </h2>
                    {
                      featuredPost.Excerpt && (
                        <p class="text-slate-600 text-base leading-relaxed line-clamp-3">
                          {featuredPost.Excerpt}
                        </p>
                      )
                    }
                  </div>
                </a>
              </div>
            )
          }

          <!-- Top Stories -->
          {
            topPosts.length > 0 && (
              <div class="space-y-6">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Top Stories</h3>
                {
                  topPosts.map((post) => (
                    <a href={getPostLink(post.Slug)} class="block group">
                      <div class="flex gap-4">
                        <div class="flex-shrink-0 w-24 h-24 rounded-md overflow-hidden bg-slate-200">
                          {
                            post.FeaturedImage && post.FeaturedImage.Url ? (
                              <img 
                                src={import.meta.env.DEV ? post.FeaturedImage.Url : filePath(new URL(post.FeaturedImage.Url))} 
                                alt={post.Title}
                                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                              />
                            ) : (
                              <div class="w-full h-full flex items-center justify-center bg-slate-300">
                                <svg class="w-8 h-8 text-slate-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                                </svg>
                              </div>
                            )
                          }
                        </div>
                        <div class="flex-1 min-w-0">
                          <h4 class="text-base font-bold text-slate-900 group-hover:text-blue-600 transition-colors leading-snug line-clamp-2 mb-1">
                            {post.Title}
                          </h4>
                          <div class="text-xs text-slate-500">
                            <PostDate post={post} />
                          </div>
                        </div>
                      </div>
                    </a>
                  ))
                }
              </div>
            )
          }
        </div>
      </section>
    )
  }

  <div slot="main" class="" style="max-width: 100%;">
  <!-- <div slot="main" class="bg-white rounded-lg p-0 shadow-sm"> -->

    {
      posts.length === 0 ? (
        <NoContents contents={posts} />
      ) : (
        <div class="p-0" style="max-width: 100%; margin-left: -1.25rem; margin-right: -1.25rem;">
          <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-6 px-5">Ultimus publikasons</h3>
          {posts.map((post, index) => (
            <article class="flex gap-4 py-4 px-5 transition-colors last:border-b-0 max-sm:flex-col max-sm:gap-3 max-sm:py-4 max-sm:px-4 cursor-pointer hover:bg-slate-50">
              {post.FeaturedImage && post.FeaturedImage.Url && (
                <div class="w-32 h-24  rounded-md overflow-hidden bg-slate-200 max-sm:w-full max-sm:h-40">
                  <PostFeaturedImage post={post} />
                </div>
              )}
              <div class="flex-1 min-w-0 flex flex-col justify-start">

                  <PostTags post={post} enableLink={true} />
                <h1 class="m-0  text-lg font-bold text-slate-900 leading-tight hover:text-blue-600 transition-colors">
                  <PostTitle post={post} enableLink={true} />
                </h1>
                <div class="">
                </div>
                <p class="m-0 text-slate-600 text-base leading-relaxed line-clamp-3">
                  {post.Excerpt}
                </p>
              </div>
            </article>
          ))}
        </div>
      )
    }

    <footer class="py-8 px-8 border-t border-slate-200 text-center">
      <Pagination currentPage={1} numberOfPages={numberOfPages} tag="" />
    </footer>
  </div>

  <div slot="aside" class="flex flex-col gap-3">
    <!-- Advertisement 1 -->
    <!-- <div class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-lg p-6 relative overflow-hidden">
      <div class="absolute -top-1/2 -right-1/2 w-full h-full bg-white/10 rounded-full rotate-45"></div>
      <div class="relative z-10">
        <div class="flex justify-between items-center mb-4">
          <div class="font-bold text-xl">WIZ</div>
          <div class="bg-white/20 px-2 py-1 rounded text-xs font-medium">Gartner</div>
        </div>
        <h3 class="m-0 mb-2.5 text-lg font-semibold">2025 Gartner Market Guide for CNAPP</h3>
        <p class="m-0 mb-5 text-sm opacity-90">Wiz named a Representative Vendor</p>
        <button class="bg-white text-indigo-500 border-0 px-5 py-2.5 rounded-md font-semibold cursor-pointer transition-transform hover:-translate-y-0.5">Download now</button>
      </div>
    </div> -->
	    <!-- Newsletter Subscription Banner -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white rounded-lg p-6 mb-8 relative overflow-hidden">
      <div class="absolute -top-1/2 -right-1/2 w-full h-full bg-white/10 rounded-full rotate-45"></div>
      <div class="relative z-10">
        <div class="flex justify-between items-center mb-4">
          <div class="font-bold text-2xl">ðŸ“§</div>
          <div class="bg-white/20 px-3 py-1 rounded-full text-sm font-medium">Di grasa</div>
        </div>
        <h2 class="m-0 mb-2 text-xl font-bold text-white">Fika ligadu</h2>
        <p class="m-0 mb-4 text-sm opacity-90 text-white">Resebe kes ultimu artigu i stÃ³rias na bu email 
		</p>
	<div class="flex gap-3 max-sm:flex-col">
           <input 
             type="email" 
             placeholder="Bu email" 
             class="flex-1 px-4 py-2 rounded-md border-0 text-slate-900 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-white/50"
           />
           <button class="bg-white text-blue-600 border-0 px-6 py-2 rounded-md font-semibold cursor-pointer transition-transform hover:-translate-y-0.5 hover:bg-blue-50 whitespace-nowrap">
             Inskreve
           </button>
         </div>
      </div>
    </div>

    <!-- Call to Action -->
    <!-- <div class="bg-blue-600 text-white rounded-lg p-6 text-center">
      <div class="cta-content">
        <div class="text-4xl mb-4">ðŸ”’</div>
        <h3 class="m-0 mb-2.5 text-lg font-semibold">Share your cybersecurity experience and expertise.</h3>
        <p class="m-0 text-sm opacity-90">Join our community of security professionals</p>
      </div>
    </div> -->

  </div>
</Layout>


