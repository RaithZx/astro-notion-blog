---
import { NUMBER_OF_POSTS_PER_PAGE } from '../server-constants.ts'
import {
  getPosts,
  getRankedPosts,
  getAllTags,
  getNumberOfPages,
} from '../lib/notion/client.ts'
import Layout from '../layouts/Layout.astro'
import NoContents from '../components/NoContents.astro'
import PostDate from '../components/PostDate.astro'
import PostTags from '../components/PostTags.astro'
import PostTitle from '../components/PostTitle.astro'
import PostFeaturedImage from '../components/PostFeaturedImage.astro'
import PostExcerpt from '../components/PostExcerpt.astro'
import ReadMoreLink from '../components/ReadMoreLink.astro'
import Pagination from '../components/Pagination.astro'
import BlogPostsLink from '../components/BlogPostsLink.astro'
import BlogTagsLink from '../components/BlogTagsLink.astro'

const [posts, rankedPosts, tags, numberOfPages] = await Promise.all([
  getPosts(NUMBER_OF_POSTS_PER_PAGE),
  getRankedPosts(),
  getAllTags(),
  getNumberOfPages(),
])
---

<Layout title="Home" description="Latest cybersecurity news and insights" path="/" ogImage="">
  <div slot="main" class="">
  <!-- <div slot="main" class="bg-white rounded-lg p-0 shadow-sm"> -->
    {
      posts.length === 0 ? (
        <NoContents contents={posts} />
      ) : (
        <div class="p-0">
          {posts.map((post, index) => (
            <article class="flex items-center gap-3 py-3 px-6 border-b border-slate-200 transition-colors  last:border-b-0 max-sm:flex-col max-sm:gap-2 max-sm:py-3 max-sm:px-4 cursor-pointer">
              <div class="flex-shrink-0 w-32 h-24 rounded-md overflow-hidden bg-slate-200 max-sm:w-full max-sm:h-40">
                {post.FeaturedImage && post.FeaturedImage.Url ? (
                  <PostFeaturedImage post={post} />
                ) : (
                  <div class="w-full h-full bg-slate-300 flex items-center justify-center">
                    <svg class="w-5 h-5 text-slate-500" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                    </svg>
                  </div>
                )}
              </div>
              <div class="flex-1 flex flex-col gap-0.5 ml-2">
                <div class="flex items-center gap-2 text-xs text-slate-500">
                  {/* <PostDate post={post} /> */}
                  <PostTags post={post} enableLink={true} />
                </div>
                <h1 class="m-0 text-base font-semibold text-slate-800 leading-tight">
                  <PostTitle post={post} enableLink={true} />
                </h1>
                <p class="m-0 text-slate-500 text-xs leading-snug line-clamp-2">
                  <PostExcerpt post={post} />
                </p>
                </div>
            </article>
          ))}
        </div>
      )
    }

    <footer class="py-8 px-8 border-t border-slate-200 text-center">
      <Pagination currentPage={1} numberOfPages={numberOfPages} tag="" />
    </footer>
  </div>

  <div slot="aside" class="flex flex-col gap-6">
    <!-- Advertisement 1 -->
    <div class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-lg p-6 relative overflow-hidden">
      <div class="absolute -top-1/2 -right-1/2 w-full h-full bg-white/10 rounded-full rotate-45"></div>
      <div class="relative z-10">
        <div class="flex justify-between items-center mb-4">
          <div class="font-bold text-xl">WIZ</div>
          <div class="bg-white/20 px-2 py-1 rounded text-xs font-medium">Gartner</div>
        </div>
        <h3 class="m-0 mb-2.5 text-lg font-semibold">2025 Gartner Market Guide for CNAPP</h3>
        <p class="m-0 mb-5 text-sm opacity-90">Wiz named a Representative Vendor</p>
        <button class="bg-white text-indigo-500 border-0 px-5 py-2.5 rounded-md font-semibold cursor-pointer transition-transform hover:-translate-y-0.5">Download now</button>
      </div>
    </div>

    <!-- Call to Action -->
    <div class="bg-blue-600 text-white rounded-lg p-6 text-center">
      <div class="cta-content">
        <div class="text-4xl mb-4">ðŸ”’</div>
        <h3 class="m-0 mb-2.5 text-lg font-semibold">Share your cybersecurity experience and expertise.</h3>
        <p class="m-0 text-sm opacity-90">Join our community of security professionals</p>
      </div>
    </div>

    <!-- Recommended Posts -->
    <div class="bg-white border border-slate-200 rounded-lg p-5">
      <h3 class="m-0 mb-4 text-lg font-semibold text-slate-800 border-b-2 border-blue-600 pb-2">Recommended</h3>
      <BlogPostsLink heading="" posts={rankedPosts} />
    </div>

    <!-- Categories -->
    <div class="bg-white border border-slate-200 rounded-lg p-5">
      <h3 class="m-0 mb-4 text-lg font-semibold text-slate-800 border-b-2 border-blue-600 pb-2">Categories</h3>
      <BlogTagsLink heading="" tags={tags} />
    </div>
  </div>
</Layout>


