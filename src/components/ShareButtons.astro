---
export interface Props {
  title: string
  url: string
  description?: string
}

const { title, url, description = '' } = Astro.props

const encodedTitle = encodeURIComponent(title)
const encodedUrl = encodeURIComponent(url)
const encodedDescription = encodeURIComponent(description)

const shareLinks = {
  twitter: `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`,
  facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,
  linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`,
  whatsapp: `https://wa.me/?text=${encodedTitle}%20${encodedUrl}`,
}
---

<div class="share-buttons">
  <span class="share-label">Partilha:</span>
  <div class="share-icons">
    <a
      href={shareLinks.twitter}
      target="_blank"
      rel="noopener noreferrer"
      class="share-icon"
      aria-label="Partilha na Twitter"
      title="Twitter"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path>
      </svg>
    </a>
    <a
      href={shareLinks.facebook}
      target="_blank"
      rel="noopener noreferrer"
      class="share-icon"
      aria-label="Partilha na Facebook"
      title="Facebook"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
      </svg>
    </a>
    <a
      href={shareLinks.linkedin}
      target="_blank"
      rel="noopener noreferrer"
      class="share-icon"
      aria-label="Partilha na LinkedIn"
      title="LinkedIn"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
        <rect x="2" y="9" width="4" height="12"></rect>
        <circle cx="4" cy="4" r="2"></circle>
      </svg>
    </a>
    <a
      href={shareLinks.whatsapp}
      target="_blank"
      rel="noopener noreferrer"
      class="share-icon"
      aria-label="Partilha na WhatsApp"
      title="WhatsApp"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 21l1.65-3.8a9 9 0 1 1 3.4 2.9L3 21"></path>
        <path d="M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0v1a5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1"></path>
      </svg>
    </a>
    <button
      class="share-icon share-copy"
      aria-label="Kopia link"
      title="Kopia link"
      data-url={url}
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </button>
  </div>
</div>

<style>
  .share-buttons {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 0;
    border-top: 1px solid #e2e8f0;
    border-bottom: 1px solid #e2e8f0;
    margin: 1.5rem 0;
  }

  .share-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #64748b;
    white-space: nowrap;
  }

  .share-icons {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .share-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    color: #64748b;
    background-color: #f1f5f9;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    cursor: pointer;
    text-decoration: none;
  }

  .share-icon:hover {
    color: white;
    background-color: #3b82f6;
    border-color: #3b82f6;
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  .share-icon:focus-visible {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
  }

  .share-icon.share-copy {
    background: none;
    border: none;
    padding: 0;
  }

  @media (max-width: 640px) {
    .share-buttons {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .share-icon {
      width: 2.25rem;
      height: 2.25rem;
    }
  }
</style>

<script>
  (function() {
    const copyButton = document.querySelector('.share-copy')
    
    if (!copyButton) return

    copyButton.addEventListener('click', async function() {
      const url = this.getAttribute('data-url')
      if (!url) return

      try {
        await navigator.clipboard.writeText(url)
        
        // Visual feedback
        const originalHTML = this.innerHTML
        this.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        `
        this.style.color = '#10b981'
        
        setTimeout(() => {
          this.innerHTML = originalHTML
          this.style.color = ''
        }, 2000)
      } catch (err) {
        console.error('Failed to copy:', err)
      }
    })
  })()
</script>
