---
import * as interfaces from '../../lib/interfaces.ts'
import RichText from './RichText.astro'

export interface Props {
  block: interfaces.Block
}

const { block } = Astro.props
---

<div class="table">
  <table>
    <tbody>
      {
        block.Table.Rows.map((tableRow: interfaces.TableRow, j: number) => (
          <tr>
            {tableRow.Cells.map((cell: interfaces.TableCell, i: number) => {
              if (
                (block.Table.HasRowHeader && i === 0) ||
                (block.Table.HasColumnHeader && j === 0)
              ) {
                return (
                  <th>
                    {cell.RichTexts.map((richText: interfaces.RichText) => (
                      <RichText richText={richText} />
                    ))}
                  </th>
                )
              }
              return (
                <td>
                  {cell.RichTexts.map((richText: interfaces.RichText) => (
                    <RichText richText={richText} />
                  ))}
                </td>
              )
            })}
          </tr>
        ))
      }
    </tbody>
  </table>
</div>

<style>
  .table {
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    margin: 0.6rem 0;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
  }
  
  .table::-webkit-scrollbar {
    height: 8px;
  }
  
  .table::-webkit-scrollbar-track {
    background: transparent;
  }
  
  .table::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
  }
  
  .table::-webkit-scrollbar-thumb:hover {
    background-color: rgba(0, 0, 0, 0.3);
  }
  
  .table table {
    margin: 0;
    width: 100%;
    max-width: 100%;
    min-width: 100%;
    table-layout: auto;
    border-collapse: collapse;
    display: table;
  }
  
  .table th,
  .table td {
    font-weight: normal;
    word-break: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    padding: 0.5rem 1rem;
    border: 1px solid #e4e4e4;
    vertical-align: top;
  }
  
  .table th {
    font-weight: 600;
    background-color: #f4f4f4;
    position: sticky;
    left: 0;
    z-index: 1;
  }
  
  /* Mobile responsive styles */
  @media (max-width: 640px) {
    .table {
      margin: 0.4rem -1rem;
      padding: 0 1rem;
    }
    
    .table table {
      font-size: 0.85rem;
      min-width: 500px; /* Minimum width to maintain readability */
    }
    
    .table th,
    .table td {
      padding: 0.4rem 0.6rem;
      font-size: 0.85rem;
      white-space: normal;
    }
    
    .table th {
      position: static; /* Remove sticky on mobile for better scrolling */
    }
  }
  
  /* Very small screens - card layout option */
  @media (max-width: 480px) {
    .table table {
      min-width: 400px;
    }
    
    .table th,
    .table td {
      padding: 0.3rem 0.5rem;
      font-size: 0.8rem;
    }
  }
</style>
